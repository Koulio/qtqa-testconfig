<?xml version="1.0" encoding="UTF-8"?>

<!--
    This is the recommended Pulse file to use when integrating pulseconfig.git
    into a Pulse project.
-->

<project default-recipe="generic test">
    <recipe name="generic test">

        <executable name="Clean before build" exe="git" args="clean -dqffx">
            <process processor="$(Qt errors)"/>
        </executable>

        <executable name="git clone pulseconfig" exe="git" args="clone qtgitreadonly:qa-dungeon/pulseconfig.git _pulseconfig">
            <process processor="$(Qt errors)"/>
        </executable>

        <executable name="Run test" exe="perl" args="_pulseconfig/test.pl">
            <process processor="$(Qt errors)"/>
            <dir-artifact name="Global artifacts" fail-if-not-present="false">
                <include pattern="_artifacts/**"/>
            </dir-artifact>
            <dir-artifact name="Test logs" fail-if-not-present="false">
                <include pattern="_artifacts/test-logs/**/*.txt"/>
                <process processor="$(qtestlib plaintext report processor)"/>
            </dir-artifact>
            <dir-artifact name="XML test logs" fail-if-not-present="false">
                <include pattern="_artifacts/test-logs/**/*.xml"/>
                <process processor="$(qtestlib xml report processor)"/>
            </dir-artifact>
        </executable>

        <executable name="Clean after build" exe="git" args="clean -dqffx" force="true">
            <process processor="$(Qt errors)"/>
            <!--
                Do not fail if clean fails here - it can fail if e.g. there is some test left over
                keeping some file locked which needs to be cleaned.
                We want to clean to save space, but it doesn't really matter if it fails
                since we clean at the beginning anyway.
            -->  
            <status-mapping code="1" status="success" />
        </executable>

    </recipe>

    <recipe name="empty test">
    </recipe>
</project>
